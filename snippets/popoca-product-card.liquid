{%- doc -%}
  This snippet is used to render a Popoca product card.
  
  @param {object} product - The product object
  @param {boolean} show_price - Whether to show the price or not
  @param {number} [max_description_length] - The length the description is allowed to be

{%- enddoc -%}

<article
    data-popular-product-card
    data-product-id="{{ product.id }}"
    class="w-[300px]">
    <div class="w-full aspect-[2/3] overflow-hidden rounded-lg bg-gray-100 relative cursor-pointer">
        {{ product.selected_or_first_available_variant.featured_media 
            | image_url: width: 900 
            | image_tag: class: 'w-full h-full object-cover z-10',
            alt: product.title,
            data-featured-image: 'true' 
        }}

        {{ product.selected_or_first_available_variant.metafields.custom.secondary_image
            | image_url: width: 900 
            | image_tag: class: 'w-full h-full object-cover z-20 absolute inset-0 transition-opacity duration-300 opacity-0 hover:opacity-100',
            alt: product.title,
            data-secondary-image-el: 'true' 
        }}

        <p data-on-sale class="hidden absolute font-bold text-lg text-red-600 top-2 left-2 bg-white rounded-md p-1">{{ 'content.product_badge_sale' | t}}</p>
    </div>

    <div class="mt-4">
        <h2 class="text-xl text-red-600 font-bold">{{ product.title }}</h2>
        <ul>
            {%- for variant in product.variants -%}

            {% endfor %}
            
        </ul>
        <p data-price-el class="font-bold">{{ product.selected_or_first_available_variant.price | money }}</p>
        <p>{{ product.description }}</p>

        {% comment %} variant buttons {% endcomment %}
        {%- if product.variants.size > 1 -%}
            <fieldset class="flex mt-4">
                <legend class="sr-only">Choose a size</legend>

                {%- for variant in product.variants -%}
                    {%- assign primary_url = variant.featured_media | default: product.featured_media | image_url: width: 900 -%}

                    {%- assign secondary_mf = variant.metafields.custom.secondary_image -%}
                    {%- if secondary_mf -%}
                        {%- assign secondary_url = secondary_mf.value | default: product.featured_media | image_url: width: 900 -%}
                    {%- else -%}
                        {%- assign secondary_url = '' -%}
                    {%- endif -%}
                    <div>
                        <input
                            type="radio"
                            name="variant_{{ product.id }}"
                            value="{{ variant.id }}"
                            id="popoca-card-{{ variant.id }}"
                            class="sr-only peer"
                            aria-label="{{ variant.name | default: variant.title }}"
                            data-variant-radio
                            data-image="{{ primary_url }}"
                            data-price-cents="{{ variant.price }}"
                            data-price-money="{{ variant.price | money }}"
                            data-compare-cents="{{ variant.compare_at_price }}"
                            data-secondary-image="{{ secondary_url }}"
                            {% if forloop.first %}
                                checked
                            {% endif %}
                        >
                        <label
                            for="popoca-card-{{ variant.id }}"
                            class="cursor-pointer p-2 border-2 border-red-600 text-red-600 bg-white font-bold rounded-md hover:border-white hover:text-white hover:bg-red-600 peer-checked:border-white peer-checked:text-white peer-checked:bg-red-600"
                        >
                            {{ variant.title }}
                        </label>
                    </div>
                {%- endfor -%}

            </fieldset>
        {% endif %}
    </div>
</article>
